<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data: https:;">
    <title>CubPresence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <h1>CubPresence</h1>
            <p>Discord Custom Rich Presence</p>
            <span class="version" id="appVersion"></span>
            <div class="header-buttons">
                <button class="header-btn" id="guideBtn" title="Setup Guide">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                </button>
                <button class="header-btn" id="settingsBtn" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                </button>
            </div>
        </header>

        <!-- Update Banner -->
        <div class="update-banner" id="updateBanner" style="display: none;">
            <span id="updateText">Checking for updates...</span>
            <button id="updateAction" style="display: none;">Update</button>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Not connected</span>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="config-panel">
                <!-- Quick Presets -->
                <div class="section presets-section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                        Quick Presets
                    </h2>
                    <div class="presets-grid">
                        <button type="button" class="preset-btn" data-preset="gaming">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="6" y1="12" x2="10" y2="12"/><line x1="8" y1="10" x2="8" y2="14"/><circle cx="17" cy="10" r="1"/><circle cx="15" cy="13" r="1"/></svg>
                            Gaming
                        </button>
                        <button type="button" class="preset-btn" data-preset="streaming">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
                            Streaming
                        </button>
                        <button type="button" class="preset-btn" data-preset="coding">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                            Coding
                        </button>
                        <button type="button" class="preset-btn" data-preset="music">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
                            Music
                        </button>
                        <button type="button" class="preset-btn" data-preset="chilling">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Chilling
                        </button>
                        <button type="button" class="preset-btn" data-preset="clear">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            Clear All
                        </button>
                    </div>
                </div>

                <!-- Application ID -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
                        Application
                    </h2>
                    <div class="field">
                        <label for="clientId">Discord Application ID</label>
                        <input type="text" id="clientId" placeholder="e.g. 1234567890123456789">
                        <p class="hint">Create an app at <a href="#" id="devPortalLink">Discord Developer Portal</a> | <a href="#" id="wikiLink">View Wiki</a></p>
                    </div>
                    <div class="field">
                        <label for="activityType">Activity Type</label>
                        <select id="activityType">
                            <option value="0">Playing</option>
                            <option value="1">Streaming</option>
                            <option value="2">Listening to</option>
                            <option value="3">Watching</option>
                            <option value="5">Competing in</option>
                        </select>
                    </div>
                </div>

                <!-- Activity Text -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        Activity Text
                    </h2>
                    <div class="field">
                        <label for="details">Details (Line 1)</label>
                        <input type="text" id="details" placeholder="e.g. Playing a custom game" maxlength="128">
                    </div>
                    <div class="field">
                        <label for="state">State (Line 2)</label>
                        <input type="text" id="state" placeholder="e.g. In the main menu" maxlength="128">
                    </div>
                </div>

                <!-- Timestamps -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        Timestamps
                    </h2>
                    <div class="timestamp-options">
                        <label class="radio-option active" title="No timestamp shown">
                            <input type="radio" name="timestampType" value="none" checked> None
                        </label>
                        <label class="radio-option" title="Time since presence was last updated">
                            <input type="radio" name="timestampType" value="since_update"> Since Update
                        </label>
                        <label class="radio-option" title="Time since connected to Discord">
                            <input type="radio" name="timestampType" value="since_connection"> Since Connect
                        </label>
                        <label class="radio-option" title="Time since CubPresence was started">
                            <input type="radio" name="timestampType" value="since_app_start"> Since App Start
                        </label>
                        <label class="radio-option" title="Shows your local time today">
                            <input type="radio" name="timestampType" value="local_time"> Local Time
                        </label>
                        <label class="radio-option" title="Set a specific date and time">
                            <input type="radio" name="timestampType" value="custom"> Custom
                        </label>
                    </div>
                    <div class="custom-timestamps" id="customTimestamps" style="display: none;">
                        <div class="field-row">
                            <div class="field">
                                <label for="startDateTime">Start Date & Time</label>
                                <input type="datetime-local" id="startDateTime">
                            </div>
                            <div class="field">
                                <label for="endDateTime">End Date & Time (optional)</label>
                                <input type="datetime-local" id="endDateTime">
                            </div>
                        </div>
                        <p class="hint">Leave end time empty for elapsed time, or set both for a countdown</p>
                    </div>
                </div>

                <!-- Images -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                        Images
                    </h2>
                    <p class="hint" style="margin-bottom: 12px;">Use asset keys from your Discord app or direct image URLs</p>
                    <div class="field-row">
                        <div class="field">
                            <label for="largeImageKey">Large Image</label>
                            <input type="text" id="largeImageKey" placeholder="Asset key or URL">
                        </div>
                        <div class="field">
                            <label for="largeImageText">Large Tooltip</label>
                            <input type="text" id="largeImageText" placeholder="Hover text" maxlength="128">
                        </div>
                    </div>
                    <div class="field-row">
                        <div class="field">
                            <label for="smallImageKey">Small Image</label>
                            <input type="text" id="smallImageKey" placeholder="Asset key or URL">
                        </div>
                        <div class="field">
                            <label for="smallImageText">Small Tooltip</label>
                            <input type="text" id="smallImageText" placeholder="Hover text" maxlength="128">
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 12h6"/></svg>
                        Buttons
                    </h2>
                    <p class="hint" style="margin-bottom: 12px;">Buttons appear on your profile (you can't click your own buttons)</p>
                    <div class="field-row">
                        <div class="field">
                            <label for="btn1Label">Button 1 Label</label>
                            <input type="text" id="btn1Label" placeholder="e.g. Join Game" maxlength="32">
                        </div>
                        <div class="field">
                            <label for="btn1Url">Button 1 URL</label>
                            <input type="url" id="btn1Url" placeholder="https://...">
                        </div>
                    </div>
                    <div class="field-row">
                        <div class="field">
                            <label for="btn2Label">Button 2 Label</label>
                            <input type="text" id="btn2Label" placeholder="e.g. Website" maxlength="32">
                        </div>
                        <div class="field">
                            <label for="btn2Url">Button 2 URL</label>
                            <input type="url" id="btn2Url" placeholder="https://...">
                        </div>
                    </div>
                </div>

                <!-- Party -->
                <div class="section">
                    <h2>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        Party (Optional)
                    </h2>
                    <div class="field-row">
                        <div class="field">
                            <label for="partySize">Party Size</label>
                            <input type="number" id="partySize" placeholder="e.g. 2" min="0">
                        </div>
                        <div class="field">
                            <label for="partyMax">Party Max</label>
                            <input type="number" id="partyMax" placeholder="e.g. 5" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview Panel -->
            <div class="preview-panel">
                <h3>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    Live Preview
                </h3>
                <p class="preview-subtitle">How others see your presence</p>
                <div class="discord-preview">
                    <div class="preview-header-bar">
                        <span class="preview-activity-type" id="previewActivityType">Playing</span>
                    </div>
                    <div class="preview-card">
                        <div class="preview-body">
                            <div class="preview-images">
                                <div class="preview-large" id="previewLarge">
                                    <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32" opacity="0.5"><path d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02z"/></svg>
                                </div>
                                <div class="preview-small" id="previewSmall"></div>
                            </div>
                            <div class="preview-info">
                                <div class="preview-name" id="previewName">Your App Name</div>
                                <div class="preview-details" id="previewDetails">Add some details...</div>
                                <div class="preview-state" id="previewState"></div>
                                <div class="preview-timestamp" id="previewTimestamp">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    <span id="previewTimeText"></span>
                                </div>
                            </div>
                        </div>
                        <div class="preview-buttons" id="previewButtons">
                            <div class="preview-btn-placeholder">Buttons will appear here</div>
                        </div>
                    </div>
                </div>
                <div class="preview-tips">
                    <p><strong>Tip:</strong> Click "Connect" to see your actual presence on Discord!</p>
                </div>
            </div>
        </main>

        <!-- Action Buttons -->
        <footer class="actions">
            <button class="btn btn-connect" id="connectBtn">
                <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M19.27 5.33C17.94 4.71 16.5 4.26 15 4a.09.09 0 0 0-.07.03c-.18.33-.39.76-.53 1.09a16.09 16.09 0 0 0-4.8 0c-.14-.34-.35-.76-.54-1.09c-.01-.02-.04-.03-.07-.03c-1.5.26-2.93.71-4.27 1.33c-.01 0-.02.01-.03.02c-2.72 4.07-3.47 8.03-3.1 11.95c0 .02.01.04.03.05c1.8 1.32 3.53 2.12 5.24 2.65c.03.01.06 0 .07-.02c.4-.55.76-1.13 1.07-1.74c.02-.04 0-.08-.04-.09c-.57-.22-1.11-.48-1.64-.78c-.04-.02-.04-.08-.01-.11c.11-.08.22-.17.33-.25c.02-.02.05-.02.07-.01c3.44 1.57 7.15 1.57 10.55 0c.02-.01.05-.01.07.01c.11.09.22.17.33.26c.04.03.04.09-.01.11c-.52.31-1.07.56-1.64.78c-.04.01-.05.06-.04.09c.32.61.68 1.19 1.07 1.74c.03.01.06.02.09.01c1.72-.53 3.45-1.33 5.25-2.65c.02-.01.03-.03.03-.05c.44-4.53-.73-8.46-3.1-11.95c-.01-.01-.02-.02-.04-.02z"/></svg>
                Connect to Discord
            </button>
            <button class="btn btn-disconnect" id="disconnectBtn" style="display: none;">
                Disconnect
            </button>
            <button class="btn btn-update" id="updateBtn" style="display: none;">
                Update Presence
            </button>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Startup</h3>
                    <label class="toggle-option">
                        <span>Run on system startup</span>
                        <input type="checkbox" id="settingRunOnStartup">
                        <span class="toggle-slider"></span>
                    </label>
                    <label class="toggle-option">
                        <span>Start minimized to tray</span>
                        <input type="checkbox" id="settingStartMinimized">
                        <span class="toggle-slider"></span>
                    </label>
                    <label class="toggle-option">
                        <span>Auto-connect on startup</span>
                        <input type="checkbox" id="settingAutoConnect">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Behavior</h3>
                    <label class="toggle-option">
                        <span>Minimize to tray on close</span>
                        <input type="checkbox" id="settingMinimizeToTray">
                        <span class="toggle-slider"></span>
                    </label>
                    <label class="toggle-option">
                        <span>Show notifications</span>
                        <input type="checkbox" id="settingShowNotifications">
                        <span class="toggle-slider"></span>
                    </label>
                    <label class="toggle-option">
                        <span>Remember presence on close</span>
                        <input type="checkbox" id="settingSavePresence">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Updates</h3>
                    <label class="toggle-option">
                        <span>Check for updates on startup</span>
                        <input type="checkbox" id="settingCheckUpdates">
                        <span class="toggle-slider"></span>
                    </label>
                    <label class="toggle-option">
                        <span>Auto-download updates</span>
                        <input type="checkbox" id="settingAutoDownload">
                        <span class="toggle-slider"></span>
                    </label>
                    <button class="btn btn-secondary" id="checkUpdatesBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9"/></svg>
                        Check for Updates Now
                    </button>
                </div>
                <div class="settings-section">
                    <h3>Data</h3>
                    <button class="btn btn-danger" id="clearDataBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Clear Saved Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Modal -->
    <div class="modal" id="guideModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Setup Guide</h2>
                <button class="modal-close" id="closeGuide">&times;</button>
            </div>
            <div class="modal-body guide-content">
                <div class="guide-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Create a Discord Application</h4>
                        <p>Go to the <a href="#" class="guide-link" data-url="https://discord.com/developers/applications">Discord Developer Portal</a> and click <strong>"New Application"</strong>.</p>
                        <p>Give your application a name - this will be the title shown in your Rich Presence (e.g., "Playing <em>Your App Name</em>").</p>
                    </div>
                </div>
                <div class="guide-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Copy Your Application ID</h4>
                        <p>On your application's page, find the <strong>"Application ID"</strong> (also called Client ID) and copy it.</p>
                        <p>Paste this ID into the "Discord Application ID" field in CubPresence.</p>
                    </div>
                </div>
                <div class="guide-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Add Images (Optional)</h4>
                        <p>In the Developer Portal, go to <strong>"Rich Presence" > "Art Assets"</strong>.</p>
                        <p>Upload images and give them names (keys). Use these names in the Large/Small Image fields.</p>
                        <p><em>Tip: You can also use direct image URLs (https://...) instead of asset keys!</em></p>
                    </div>
                </div>
                <div class="guide-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Configure Your Presence</h4>
                        <ul>
                            <li><strong>Details:</strong> The main text line (e.g., "Playing Campaign")</li>
                            <li><strong>State:</strong> The secondary text line (e.g., "Level 5")</li>
                            <li><strong>Timestamps:</strong> Show elapsed time or countdown</li>
                            <li><strong>Buttons:</strong> Add up to 2 clickable buttons with URLs</li>
                            <li><strong>Party:</strong> Show party size (e.g., "2 of 5")</li>
                        </ul>
                    </div>
                </div>
                <div class="guide-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>Connect!</h4>
                        <p>Make sure Discord is running, then click <strong>"Connect to Discord"</strong>.</p>
                        <p>Your presence will appear on your Discord profile. Use "Update Presence" to change it without disconnecting.</p>
                    </div>
                </div>
                <div class="guide-tips">
                    <h4>Tips & Tricks</h4>
                    <ul>
                        <li>Enable <strong>"Auto-connect on startup"</strong> in Settings to automatically connect when CubPresence opens.</li>
                        <li>Enable <strong>"Run on system startup"</strong> to have CubPresence launch with Windows.</li>
                        <li>The app minimizes to your system tray - right-click the tray icon for quick actions.</li>
                        <li>Your presence settings are saved automatically and restored when you reopen the app.</li>
                        <li>You cannot see your own buttons - ask a friend to verify they work!</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
